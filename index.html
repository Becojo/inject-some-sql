<!DOCTYPE html>
<html>
<head>
  <title>Rails SQL Injection Examples</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" media="all" href="/assets/application-9f21d3751af0800669a7d0851d376ca01b98314f3a9a4107355c13896b8874d3.css" />
  <script src="/assets/application-c66b8f92274fed3b1070aeaa1cbc1a3bdebc498ce382906d733a260901372231.js"></script>
  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="H0EA6aQTDou5Z8hPi5zsSaRP45uyV2nxig12kGA3YT3lwIY42LVNQ1ppnfegpl-EwnXNQKUYDCREL9fswqKDpA" />
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">Rails SQL Injection</a>
        <div class="nav-collapse">
          <ul class="nav pull-right">
            <li><a href="/rails3">Rails 3</a></li>
            <li><a href="/rails4">Rails 4</a></li>
            <li><a href="/rails5">Rails 5</a></li>
            <li class="active"><a href="">Rails 6</a></li>
            <li><a href="#resources">More Resources</a></li>
          </ul>

          <ul class="nav pull-right" style="padding-right: 15px">
            <select onchange="window.scrollTo(0, $(this.value).offset().top - 50)" style="margin-top: 5px; margin-bottom: 0px;">
              <option value="#overview">Overview</option>
                <option value="#calculate">Calculate Methods</option>
                <option value="#delete_by">Delete By Method</option>
                <option value="#destroy_all">Destroy All Method</option>
                <option value="#exists">Exists? Method</option>
                <option value="#find_by">Find By Method</option>
                <option value="#from_method">From Method</option>
                <option value="#group_method">Group Method</option>
                <option value="#having">Having Method</option>
                <option value="#joins">Joins Method</option>
                <option value="#lock">Lock Method and Option</option>
                <option value="#not">Not Method</option>
                <option value="#select_method">Select Method</option>
                <option value="#reselect_method">Reselect Method</option>
                <option value="#where">Where Method</option>
                <option value="#rewhere">Rewhere Method</option>
                <option value="#update_all_method">Update All Method</option>
            </select>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <h2 id="overview">Overview</h2>
<p>
The <a href="http://rubyonrails.org/">Ruby on Rails</a> web framework provides a library called <a href="http://guides.rubyonrails.org/active_record_querying.html">ActiveRecord</a> which provides an abstraction for accessing databases.
</p>
<p>
This page lists many query methods and options in ActiveRecord which do not sanitize raw SQL arguments and are not intended to be called with unsafe user input. Careless use of these methods can open up code to <a href="https://owasp.org/index.php/SQL_Injection">SQL Injection</a> exploits. The examples here do not include SQL injection from known CVEs and are not vulnerabilites themselves, only potential misuses of the methods.
</p>
<p>
Please use this list as a guide of what <em>not</em> to do.
</p>
<p>
This list is in no way exhaustive or complete! Please feel free to <a href="https://github.com/presidentbeef/inject-some-sql">contribute</a>.
</p>
<h3>Examples</h3>
<p>
Each method or option described below is accompanied by an example demonstrating how the ActiveRecord interface could be exploited if used unsafely. These are not necessarily the <em>worst</em> exploits, they represent just a small hint of what could be accomplished if one is not careful. The examples on this page were tested with <b>Rails 6.1.4</b> and SQLite 3.
</p>
<h3>Interactive Version</h3>
<p>
Clone and run this site from <a href="https://github.com/presidentbeef/inject-some-sql">the git repo</a> to try out or modify the examples!
</p>
<table class="table">
  <tr>
    <td>
      <div id="calculate">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/Calculations.html#method-i-calculate">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Calculate Methods</h3>

  <div>
    <p>There are several methods based around <code>ActiveRecord::Calculations#calculate</code>.</p>

<p><code>calculate</code> takes an operation and a column name. The column name argument accepts SQL.</p>

<p>The other calculation methods just call <code>calculate</code>, so they also accept SQL in place of column names.</p>

<p>Calculation methods:</p>

<ul>
<li>average</li>
<li>calculate</li>
<li>count</li>
<li>maximum</li>
<li>minimum</li>
<li>sum</li>
</ul>


  </div>

  <h4>Example</h4>
  <p>
    <p>This example finds the age of a specific user, rather than the sum of order amounts.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:column</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">age) FROM users WHERE name = 'Bob';</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">Order</span>.calculate(<span style="color:#A60">:sum</span>, params[<span style="color:#A60">:column</span>])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="color:#369;font-weight:bold">SUM</span>(age) <span style="color:#080;font-weight:bold">FROM</span> users <span style="color:#080;font-weight:bold">WHERE</span> name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Bob</span><span style="color:#710">'</span></span>;) <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span></span>
    </div>
    <strong>Result</strong>
    <div>
      50
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="delete_by">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/Relation.html#method-i-delete_by">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Delete By Method</h3>

  <div>
    <p>Any methods which delete records should definitely be used with care!</p>

<p>The <code>delete_all</code> method takes the same kind of conditions arguments as <code>where</code>.
The argument can be a string, an array, or a hash of conditions. Strings will not
be escaped at all. Use an array or hash to safely parameterize arguments.</p>

<p>Never pass user input directly to <code>delete_by</code>.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This example bypasses any conditions and deletes all users.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:id</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1) OR 1=1--</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.delete_by(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id = </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:id</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">DELETE</span> <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> (id = <span style="color:#00D">1</span>) <span style="color:#080;font-weight:bold">OR</span> <span style="color:#00D">1</span>=<span style="color:#00D">1</span><span style="color:#777">--)</span></span>
    </div>
    <strong>Result</strong>
    <div>
      6
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="destroy_all">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/Relation.html#method-i-destroy_by">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Destroy All Method</h3>

  <div>
    <p>Any methods which delete records should be used with lots of caution! <code>destroy_by</code> is only slightly safer
than <code>delete_by</code> since it will invoke callbacks associated with the model.</p>

<p>The <code>destroy_by</code> method takes the same kind of conditions arguments as <code>where</code>.
The argument can be a string, an array, or a hash of conditions. Strings will not
be escaped at all. Use an array or hash to safely parameterize arguments.</p>

<p>Never pass user input directly to <code>destroy_by</code>.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This example bypasses any conditions and deletes all users.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:admin</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">') OR 1=1--'</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.destroy_by([<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id = ? AND admin = '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:admin</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>, params[<span style="color:#A60">:id</span>]])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">DELETE</span> <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">id</span><span style="color:#710">&quot;</span></span> = <span style="color:#F00;background-color:#FAA">?</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 13, name: &quot;Bob&quot;, password: [FILTERED], age: 37, admin: false, created_at: &quot;2021-07-12 06:00:56.906780000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.906780000 +0000&quot;&gt;, #&lt;User id: 14, name: &quot;Jim&quot;, password: [FILTERED], age: 23, admin: false, created_at: &quot;2021-07-12 06:00:56.909084000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.909084000 +0000&quot;&gt;, #&lt;User id: 15, name: &quot;Sarah&quot;, password: [FILTERED], age: 48, admin: false, created_at: &quot;2021-07-12 06:00:56.911282000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.911282000 +0000&quot;&gt;, #&lt;User id: 16, name: &quot;Tina&quot;, password: [FILTERED], age: 28, admin: false, created_at: &quot;2021-07-12 06:00:56.913728000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.913728000 +0000&quot;&gt;, #&lt;User id: 17, name: &quot;Tony&quot;, password: [FILTERED], age: 49, admin: false, created_at: &quot;2021-07-12 06:00:56.916524000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.916524000 +0000&quot;&gt;, #&lt;User id: 18, name: &quot;Admin&quot;, password: [FILTERED], age: 71, admin: true, created_at: &quot;2021-07-12 06:00:56.918851000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.918851000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="exists">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/FinderMethods.html#method-i-exists-3F">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Exists? Method</h3>

  <div>
    <p>The <code>exists?</code> method is used to check if a given record exists. The argument is usually a primary key. If the argument is a string, it will be escaped. If the argument is an array or hash, it will be treated like a conditions option.</p>

<p><em>However</em>, code like this is <em>not safe</em>:</p>

<pre>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.exists? params[<span style="color:#A60">:user</span>]</span>
</pre>


<p>Since Rails will automatically convert parameters to arrays or hashes, it is possible to inject any SQL into this query.</p>

<p>For example,</p>

<p><code>?user[]=1</code></p>

<p>Will generate the query</p>

<pre>
<span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span>  <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">AS</span> one <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>  <span style="color:#080;font-weight:bold">WHERE</span> (<span style="color:#00D">1</span>) LIMIT <span style="color:#00D">1</span></span>
</pre>


<p>This query will always return true. To be be safe, convert user input to a string or integer if using it as the primary key in <code>exists?</code>.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This is more obvious than the example above, but demonstrates checking another table for a given value.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:user</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">') or (SELECT 1 AS one FROM 'orders' WHERE total &gt; 100 AND ''='</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.exists? [<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name = '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:user</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">'</span><span style="color:#710">&quot;</span></span>]</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">AS</span> one <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> (name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">or</span> (<span style="color:#B06;font-weight:bold">SELECT</span> <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">AS</span> one <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">orders</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">WHERE</span> total &gt; <span style="color:#00D">100</span> <span style="color:#080;font-weight:bold">AND</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>) LIMIT <span style="color:#F00;background-color:#FAA">?</span></span>
    </div>
    <strong>Result</strong>
    <div>
      true
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="find_by">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/FinderMethods.html#method-i-find_by">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Find By Method</h3>

  <div>
    <p>Added in Rails 4, the <code>find_by</code>/<code>find_by!</code> methods are simply calling <code>where(*args).take</code>, so all the options for <code>where</code> also apply.</p>

<p>Note that <code>find_or_create_by</code> / <code>find_or_create_by!</code> / <code>find_or_initialize_by</code> all call <code>find_by</code>
and are therefore vulnerable to SQL injeection in the same way.</p>

<p>The safest (and most common) use of these methods is to pass in a hash table.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This will find users who are admins.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:id</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">admin = '1'</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.find_by params[<span style="color:#A60">:id</span>]</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> (admin = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1</span><span style="color:#710">'</span></span>) LIMIT <span style="color:#F00;background-color:#FAA">?</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 30, name: &quot;Admin&quot;, password: [FILTERED], age: 55, admin: true, created_at: &quot;2021-07-12 06:00:56.996567000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:56.996567000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="from_method">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-from">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>From Method</h3>

  <div>
    <p>The <code>from</code> method accepts arbitrary SQL.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Instead of returning all non-admin users, we return all admin users.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:from</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users WHERE admin = '1' OR ''=?;</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.from(params[<span style="color:#A60">:from</span>]).where(<span style="color:#606">admin</span>: <span style="color:#069">false</span>).all</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> users <span style="color:#080;font-weight:bold">WHERE</span> admin = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">OR</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>=<span style="color:#F00;background-color:#FAA">?</span>; <span style="color:#080;font-weight:bold">WHERE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">admin</span><span style="color:#710">&quot;</span></span> = <span style="color:#F00;background-color:#FAA">?</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 36, name: &quot;Admin&quot;, password: [FILTERED], age: 30, admin: true, created_at: &quot;2021-07-12 06:00:57.025594000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.025594000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="group_method">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-group">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Group Method</h3>

  <div>
    <p>The <code>group</code> method accepts arbitrary SQL strings.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>The intent of this query is to group non-admin users by the specified column. Instead, the query returns all users.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:group</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name UNION SELECT * FROM users</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.where(<span style="color:#A60">:admin</span> =&gt; <span style="color:#069">false</span>).group(params[<span style="color:#A60">:group</span>])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">admin</span><span style="color:#710">&quot;</span></span> = <span style="color:#F00;background-color:#FAA">?</span> <span style="color:#080;font-weight:bold">GROUP</span> <span style="color:#080;font-weight:bold">BY</span> name <span style="color:#080;font-weight:bold">UNION</span> <span style="color:#B06;font-weight:bold">SELECT</span> * <span style="color:#080;font-weight:bold">FROM</span> users</span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 37, name: &quot;Bob&quot;, password: [FILTERED], age: 42, admin: false, created_at: &quot;2021-07-12 06:00:57.042595000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.042595000 +0000&quot;&gt;, #&lt;User id: 38, name: &quot;Jim&quot;, password: [FILTERED], age: 71, admin: false, created_at: &quot;2021-07-12 06:00:57.045683000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.045683000 +0000&quot;&gt;, #&lt;User id: 39, name: &quot;Sarah&quot;, password: [FILTERED], age: 40, admin: false, created_at: &quot;2021-07-12 06:00:57.047705000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.047705000 +0000&quot;&gt;, #&lt;User id: 40, name: &quot;Tina&quot;, password: [FILTERED], age: 74, admin: false, created_at: &quot;2021-07-12 06:00:57.049704000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.049704000 +0000&quot;&gt;, #&lt;User id: 41, name: &quot;Tony&quot;, password: [FILTERED], age: 43, admin: false, created_at: &quot;2021-07-12 06:00:57.052728000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.052728000 +0000&quot;&gt;, #&lt;User id: 42, name: &quot;Admin&quot;, password: [FILTERED], age: 56, admin: true, created_at: &quot;2021-07-12 06:00:57.055519000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.055519000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="having">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-having">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Having Method</h3>

  <div>
    <p>The <code>having</code> method does not escape its input and is easy to use for SQL injection since it tends to be at the end of a query.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This input injects a union in order to return all orders, instead of just the orders from a single user.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:total</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1) UNION SELECT * FROM orders--</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">Order</span>.where(<span style="color:#A60">:user_id</span> =&gt; <span style="color:#00D">1</span>).group(<span style="color:#A60">:user_id</span>).having(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">total &gt; </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:total</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user_id</span><span style="color:#710">&quot;</span></span> = <span style="color:#F00;background-color:#FAA">?</span> <span style="color:#080;font-weight:bold">GROUP</span> <span style="color:#080;font-weight:bold">BY</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">user_id</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">HAVING</span> (total &gt; <span style="color:#00D">1</span>) <span style="color:#080;font-weight:bold">UNION</span> <span style="color:#B06;font-weight:bold">SELECT</span> * <span style="color:#080;font-weight:bold">FROM</span> orders<span style="color:#777">--)</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;Order id: 22, user_id: 43, total: 10, created_at: &quot;2021-07-12 06:00:57.087001000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.087001000 +0000&quot;&gt;, #&lt;Order id: 23, user_id: 44, total: 500, created_at: &quot;2021-07-12 06:00:57.090103000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.090103000 +0000&quot;&gt;, #&lt;Order id: 24, user_id: 46, total: 1, created_at: &quot;2021-07-12 06:00:57.092789000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.092789000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="joins">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-joins">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Joins Method</h3>

  <div>
    <p>The <code>joins</code> method can take an array of associations or straight SQL strings.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Skip WHERE clause and return all orders instead of just the orders for the specified user.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:table</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">--</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">Order</span>.joins(params[<span style="color:#A60">:table</span>]).where(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">total &gt; 1000</span><span style="color:#710">&quot;</span></span>).all</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">orders</span><span style="color:#710">&quot;</span></span> <span style="color:#777">-- WHERE (total &gt; 1000)</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;Order id: 25, user_id: 49, total: 10, created_at: &quot;2021-07-12 06:00:57.117084000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.117084000 +0000&quot;&gt;, #&lt;Order id: 26, user_id: 50, total: 500, created_at: &quot;2021-07-12 06:00:57.119929000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.119929000 +0000&quot;&gt;, #&lt;Order id: 27, user_id: 52, total: 1, created_at: &quot;2021-07-12 06:00:57.122689000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.122689000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="lock">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-lock">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Lock Method and Option</h3>

  <div>
    <p>The <code>lock</code> method and the <code>:lock</code> option for <code>find</code> and related methods accepts a SQL fragment.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Not a real example: SQLite does not support this option.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:lock</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">?</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.where(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">id &gt; 1</span><span style="color:#710">'</span></span>).lock(params[<span style="color:#A60">:lock</span>])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> (id &gt; <span style="color:#00D">1</span>) </span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 55, name: &quot;Bob&quot;, password: [FILTERED], age: 57, admin: false, created_at: &quot;2021-07-12 06:00:57.129329000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.129329000 +0000&quot;&gt;, #&lt;User id: 56, name: &quot;Jim&quot;, password: [FILTERED], age: 40, admin: false, created_at: &quot;2021-07-12 06:00:57.131727000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.131727000 +0000&quot;&gt;, #&lt;User id: 57, name: &quot;Sarah&quot;, password: [FILTERED], age: 51, admin: false, created_at: &quot;2021-07-12 06:00:57.134123000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.134123000 +0000&quot;&gt;, #&lt;User id: 58, name: &quot;Tina&quot;, password: [FILTERED], age: 57, admin: false, created_at: &quot;2021-07-12 06:00:57.136270000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.136270000 +0000&quot;&gt;, #&lt;User id: 59, name: &quot;Tony&quot;, password: [FILTERED], age: 48, admin: false, created_at: &quot;2021-07-12 06:00:57.138301000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.138301000 +0000&quot;&gt;, #&lt;User id: 60, name: &quot;Admin&quot;, password: [FILTERED], age: 61, admin: true, created_at: &quot;2021-07-12 06:00:57.140340000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.140340000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="not">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods/WhereChain.html#method-i-not">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Not Method</h3>

  <div>
    <p>The <code>not</code> method is equivalent to <code>where</code> and is equally unsafe when passed SQL strings directly.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Return all users, even if they are administrators.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:excluded</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">?)) OR 1=1 --</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.where.not(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">admin = 1 OR id IN (</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:excluded</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span>).all</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> <span style="color:#080;font-weight:bold">NOT</span> (admin = <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">OR</span> id <span style="color:#080;font-weight:bold">IN</span> (<span style="color:#F00;background-color:#FAA">?</span>)) <span style="color:#080;font-weight:bold">OR</span> <span style="color:#00D">1</span>=<span style="color:#00D">1</span> <span style="color:#777">--))</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 61, name: &quot;Bob&quot;, password: [FILTERED], age: 25, admin: false, created_at: &quot;2021-07-12 06:00:57.156164000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.156164000 +0000&quot;&gt;, #&lt;User id: 62, name: &quot;Jim&quot;, password: [FILTERED], age: 23, admin: false, created_at: &quot;2021-07-12 06:00:57.159285000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.159285000 +0000&quot;&gt;, #&lt;User id: 63, name: &quot;Sarah&quot;, password: [FILTERED], age: 52, admin: false, created_at: &quot;2021-07-12 06:00:57.161405000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.161405000 +0000&quot;&gt;, #&lt;User id: 64, name: &quot;Tina&quot;, password: [FILTERED], age: 24, admin: false, created_at: &quot;2021-07-12 06:00:57.163382000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.163382000 +0000&quot;&gt;, #&lt;User id: 65, name: &quot;Tony&quot;, password: [FILTERED], age: 57, admin: false, created_at: &quot;2021-07-12 06:00:57.166182000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.166182000 +0000&quot;&gt;, #&lt;User id: 66, name: &quot;Admin&quot;, password: [FILTERED], age: 55, admin: true, created_at: &quot;2021-07-12 06:00:57.168733000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.168733000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="select_method">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-select">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Select Method</h3>

  <div>
    <p>The <code>:select</code> method allows complete control over the <code>SELECT</code> clause of the query.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Since the <code>SELECT</code> clause is at the beginning of the query, nearly any SQL can be injected.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:column</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">* FROM users WHERE admin = '1' ;</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.select(params[<span style="color:#A60">:column</span>])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> * <span style="color:#080;font-weight:bold">FROM</span> users <span style="color:#080;font-weight:bold">WHERE</span> admin = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">1</span><span style="color:#710">'</span></span> ; <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 72, name: &quot;Admin&quot;, password: [FILTERED], age: 45, admin: true, created_at: &quot;2021-07-12 06:00:57.200657000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.200657000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="reselect_method">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-reselect">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Reselect Method</h3>

  <div>
    <p>The <code>reselect</code> method allows complete control over the <code>SELECT</code> clause of the query.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>This is the same as <code>select</code>. Since the <code>SELECT</code> clause is at the beginning of the query, nearly any SQL can be injected, including querying totally different tables than intended.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:column</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">* FROM orders -- </span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.select(<span style="color:#A60">:name</span>).reselect(params[<span style="color:#A60">:column</span>])</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> * <span style="color:#080;font-weight:bold">FROM</span> orders <span style="color:#777">--  FROM &quot;users&quot;</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 37, created_at: &quot;2021-07-12 06:00:57.230806000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.230806000 +0000&quot;&gt;, #&lt;User id: 38, created_at: &quot;2021-07-12 06:00:57.235285000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.235285000 +0000&quot;&gt;, #&lt;User id: 39, created_at: &quot;2021-07-12 06:00:57.239363000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.239363000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="where">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-where">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Where Method</h3>

  <div>
    <p>The <code>where</code> method can be passed a straight SQL string. Calls using a hash of name-value pairs are escaped, and the array form can be used for safely parameterizing queries.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>The example below is using classic SQL injection to bypass authentication.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:name</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">') OR 1--</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.where(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name = '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:name</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">' AND password = '</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:password</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">'</span><span style="color:#710">&quot;</span></span>)</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> (name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#710">'</span></span>) <span style="color:#080;font-weight:bold">OR</span> <span style="color:#00D">1</span><span style="color:#777">--' AND password = '')</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 79, name: &quot;Bob&quot;, password: [FILTERED], age: 44, admin: false, created_at: &quot;2021-07-12 06:00:57.246304000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.246304000 +0000&quot;&gt;, #&lt;User id: 80, name: &quot;Jim&quot;, password: [FILTERED], age: 18, admin: false, created_at: &quot;2021-07-12 06:00:57.248645000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.248645000 +0000&quot;&gt;, #&lt;User id: 81, name: &quot;Sarah&quot;, password: [FILTERED], age: 50, admin: false, created_at: &quot;2021-07-12 06:00:57.250674000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.250674000 +0000&quot;&gt;, #&lt;User id: 82, name: &quot;Tina&quot;, password: [FILTERED], age: 20, admin: false, created_at: &quot;2021-07-12 06:00:57.253714000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.253714000 +0000&quot;&gt;, #&lt;User id: 83, name: &quot;Tony&quot;, password: [FILTERED], age: 59, admin: false, created_at: &quot;2021-07-12 06:00:57.256287000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.256287000 +0000&quot;&gt;, #&lt;User id: 84, name: &quot;Admin&quot;, password: [FILTERED], age: 59, admin: true, created_at: &quot;2021-07-12 06:00:57.258737000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.258737000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="rewhere">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/QueryMethods.html#method-i-rewhere">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Rewhere Method</h3>

  <div>
    <p>  Like <code>where</code>, the <code>rewhere</code> method can be passed a straight SQL string. <code>rewhere</code> adds the new conditions as a conjunction using <code>AND</code>.</p>

<p>  Calls using a hash of name-value pairs are escaped, and the array form can be used for safely parameterizing queries.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Find all users, regardless of name or age.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:age</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1=1) OR 1=1--</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.where(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Bob</span><span style="color:#710">&quot;</span></span>).rewhere(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">age &gt; </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:age</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">SELECT</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.* <span style="color:#080;font-weight:bold">FROM</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#080;font-weight:bold">WHERE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span>.<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">name</span><span style="color:#710">&quot;</span></span> = <span style="color:#F00;background-color:#FAA">?</span> <span style="color:#080;font-weight:bold">AND</span> (age &gt; <span style="color:#00D">1</span>=<span style="color:#00D">1</span>) <span style="color:#080;font-weight:bold">OR</span> <span style="color:#00D">1</span>=<span style="color:#00D">1</span><span style="color:#777">--)</span></span>
    </div>
    <strong>Result</strong>
    <div>
      [#&lt;User id: 85, name: &quot;Bob&quot;, password: [FILTERED], age: 56, admin: false, created_at: &quot;2021-07-12 06:00:57.275126000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.275126000 +0000&quot;&gt;, #&lt;User id: 86, name: &quot;Jim&quot;, password: [FILTERED], age: 51, admin: false, created_at: &quot;2021-07-12 06:00:57.277178000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.277178000 +0000&quot;&gt;, #&lt;User id: 87, name: &quot;Sarah&quot;, password: [FILTERED], age: 41, admin: false, created_at: &quot;2021-07-12 06:00:57.279972000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.279972000 +0000&quot;&gt;, #&lt;User id: 88, name: &quot;Tina&quot;, password: [FILTERED], age: 62, admin: false, created_at: &quot;2021-07-12 06:00:57.282022000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.282022000 +0000&quot;&gt;, #&lt;User id: 89, name: &quot;Tony&quot;, password: [FILTERED], age: 73, admin: false, created_at: &quot;2021-07-12 06:00:57.284467000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.284467000 +0000&quot;&gt;, #&lt;User id: 90, name: &quot;Admin&quot;, password: [FILTERED], age: 42, admin: true, created_at: &quot;2021-07-12 06:00:57.286809000 +0000&quot;, updated_at: &quot;2021-07-12 06:00:57.286809000 +0000&quot;&gt;]
    </div>
  </div>
</div>

    </td>
  </tr>
  <tr>
    <td>
      <div id="update_all_method">
  <div>
    <p class="pull-right">
      <a href="https://api.rubyonrails.org/v6.1.3/classes/ActiveRecord/Relation.html#method-i-update_all">Documentation <i class="icon-share"></i></a>
    </p>
  </div>

  <h3>Update All Method</h3>

  <div>
    <p><code>update_all</code> accepts any SQL as a string.</p>

<p>User input should never be passed directly to <code>update_all</code>, only as values in a hash table.</p>

  </div>

  <h4>Example</h4>
  <p>
    <p>Update every user to be an admin.</p>

  </p>

  <div style="margin-bottom: 4px">
      <pre>
<span class="CodeRay">params[<span style="color:#A60">:name</span>] = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">' OR 1=1;</span><span style="color:#710">&quot;</span></span></span>
<span class="CodeRay"><span style="color:#036;font-weight:bold">User</span>.update_all(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">admin = 1 WHERE name LIKE '%</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>params[<span style="color:#A60">:name</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">%'</span><span style="color:#710">&quot;</span></span>)</span></pre>
  </div>

  <div class="result well">
    <strong>Query</strong>
    <div>
      <span class="CodeRay"><span style="color:#B06;font-weight:bold">UPDATE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">users</span><span style="color:#710">&quot;</span></span> <span style="color:#B06;font-weight:bold">SET</span> admin = <span style="color:#00D">1</span> <span style="color:#080;font-weight:bold">WHERE</span> name <span style="color:#080;font-weight:bold">LIKE</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">%</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">OR</span> <span style="color:#00D">1</span>=<span style="color:#00D">1</span>;%<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span></span></span>
    </div>
    <strong>Result</strong>
    <div>
      6
    </div>
  </div>
</div>

    </td>
  </tr>
</table>

  </div>
  <hr>
  <div class="container" id="resources" style="padding-bottom:80px">
    <h2>More Resources</h2>
    <ul>
      <li><a href="http://guides.rubyonrails.org/security.html">Official Rails Security Guide</a></li>
      <li><a href="https://www.owasp.org/index.php/Ruby_on_Rails_Cheatsheet">OWASP Rails Cheatsheet</a></li>
      <li><a href="https://groups.google.com/forum/?fromgroups#!forum/rubyonrails-security">Rails Security Mailing List</a></li>
      <li><a href="https://github.com/twitter/secureheaders#readme">Secure Headers Gem</a></li>
      <li><a href="http://brakemanscanner.org">Brakeman - Static Analysis Security Tool for Rails</a></li>
    </ul>
    <p>
      This site is also available as a Rails application. To interact with this site dynamically and try out different SQL injection attacks you can <a href="https://github.com/presidentbeef/inject-some-sql">clone the code</a> and run it locally. Contributions and corrections are welcome!
    </p>
  </div>
</body>
</html>
